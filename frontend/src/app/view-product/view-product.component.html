<!-- Header -->
<app-header [searchBarHide]="true"></app-header>

<!-- Product List Section -->
<section class="py-5 mt-5">
  <div class="container px-3 px-lg-5 my-3">
    <div class="row gx-4 gx-lg-4">

      <!-- Loop through filteredProducts -->
      <div class="col-md-3 mb-4" *ngFor="let product of filteredProducts">
        <div class="card h-100 shadow-sm">
          <img
            class="card-img-top"
            [src]="product.image"
            [alt]="product.title"
          />
          <div class="card-body p-3">
            <h5 class="card-title text-danger fw-bold">
              {{ product.title | slice:0:25 }}...
            </h5>
            <p class="card-text mb-1">
              ${{ product.price }}
              <span class="text-decoration-line-through ms-2">
                ${{ (product.price + 10).toFixed(2) }}
              </span>
            </p>
            <p class="card-text">
              <span class="badge bg-light text-dark">{{ product.category }}</span>
            </p>
            <div class="d-flex justify-content-between mt-3">
              <!-- Wishlist Buttons -->
              <span
                (click)="addToWishlist(product.id)"
                *ngIf="email && wishlist.indexOf(product.id) === -1"
                class="text-secondary"
                style="cursor:pointer"
              >
                <i class="fa fa-heart-circle-plus fa-lg"></i>
              </span>
              <span
                (click)="removeFromWishlist(product.id)"
                *ngIf="email && wishlist.indexOf(product.id) >= 0"
                class="text-danger"
                style="cursor:pointer"
              >
                <i class="fa fa-heart-circle-minus fa-lg"></i>
              </span>
              <span
                *ngIf="!email"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                class="text-secondary"
                style="cursor:pointer"
              >
                <i class="fa fa-heart fa-lg"></i>
              </span>

              <!-- Add to Cart / Remove from Cart -->
              <button
                *ngIf="!email"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal2"
                class="btn btn-sm btn-danger"
              >
                <i class="fa-solid fa-cart-plus"></i>
              </button>
              <button
                *ngIf="email && cart.indexOf(product.id) >= 0"
                (click)="removeFromCart(product.id)"
                class="btn btn-sm btn-danger"
              >
                <i class="fa-solid fa-ban"></i>
              </button>
              <button
                *ngIf="email && cart.indexOf(product.id) === -1"
                (click)="addToCart(product.id)"
                class="btn btn-sm btn-success"
              >
                <i class="fa-solid fa-cart-plus"></i>
              </button>
            </div>
          </div>

          <!-- Link to Product Details -->
          <div class="card-footer text-center bg-white">
            <a [routerLink]="['/view-product', product.id]" class="btn btn-outline-danger btn-sm w-100">
              View Details
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modals for login alerts (wishlist/cart) -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3 bg-danger-subtle">
      <div class="modal-header">
        <h1 class="modal-title fs-5 text-danger" id="exampleModalLabel">
          <i class="fa-solid fa-user-plus me-3"></i>
          <strong>Please Login to add to wishlist!</strong>
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="exampleModal2"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3 bg-danger-subtle">
      <div class="modal-header">
        <h1 class="modal-title fs-5 text-danger" id="exampleModalLabel">
          <i class="fa-solid fa-user-plus me-3"></i>
          <strong>Please Login to add to cart!</strong>
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>
</div>
